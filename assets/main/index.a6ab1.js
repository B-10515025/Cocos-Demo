window.__require=function e(t,o,n){function r(i,a){if(!o[i]){if(!t[i]){var s=i.split("/");if(s=s[s.length-1],!t[s]){var p="function"==typeof __require&&__require;if(!a&&p)return p(s,!0);if(c)return c(s,!0);throw new Error("Cannot find module '"+i+"'")}i=s}var d=o[i]={exports:{}};t[i][0].call(d.exports,function(e){return r(t[i][1][e]||e)},d,d.exports,e,t,o,n)}return o[i].exports}for(var c="function"==typeof __require&&__require,i=0;i<n.length;i++)r(n[i]);return r}({Block:[function(e,t,o){"use strict";cc._RF.push(t,"1b3bbUax+BJRqSvZDJhapR8","Block");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./WebSocket"),a=cc._decorator,s=a.ccclass,p=a.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.background=[],t.leftdown=!1,t.rightdown=!1,t}return r(t,e),t.prototype.onLoad=function(){var e=this;this.node.on(cc.Node.EventType.MOUSE_DOWN,function(t){e.leftdown=t.getButton()===cc.Event.EventMouse.BUTTON_LEFT,e.rightdown=t.getButton()===cc.Event.EventMouse.BUTTON_RIGHT}),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(){e.leftdown=!1,e.rightdown=!1}),this.node.on(cc.Node.EventType.MOUSE_UP,function(t){e.node.getComponent(cc.Sprite).spriteFrame==e.background[0]&&(e.leftdown&&t.getButton()===cc.Event.EventMouse.BUTTON_LEFT&&e.click(!1),e.rightdown&&t.getButton()===cc.Event.EventMouse.BUTTON_RIGHT&&e.click(!0))})},t.prototype.update=function(){Math.abs(this.node.x+this.node.parent.x)>this.node.parent.width||Math.abs(this.node.y+this.node.parent.y)>this.node.parent.height?this.node.opacity=0:this.node.opacity=255},t.prototype.click=function(e){var t=this,o={type:"action.click",Index:this.index,flag:e};i.default.send(JSON.stringify(o),function(e){0==e.Code||1==e.Code?e.Score<0&&t.game.menu.youdied():2==e.Code?(t.game.pid=-1,alert("Player is dead")):3==e.Code?(t.game.pid=-1,alert("Have not join game")):4==e.Code?alert("Game has not started"):alert("Unkonwn error")})},t.prototype.setState=function(e){var t=this.game.colors[Math.floor(e/10)];Math.floor(e/10)==this.game.pid&&(t=cc.color(255,255,255)),this.node.color=e<0?cc.Color.WHITE:t,this.node.getComponent(cc.Sprite).spriteFrame=e<0||e%10==9?this.background[0]:this.background[1],this.node.children[0].getComponent(cc.Label).string=e%10>0&&e%10<9?Math.floor(e%10).toString():"",this.node.children[1].active=e%10==9},c([p([cc.SpriteFrame])],t.prototype,"background",void 0),c([s],t)}(cc.Component);o.default=d,cc._RF.pop()},{"./WebSocket":"WebSocket"}],LeaderBoard:[function(e,t,o){"use strict";cc._RF.push(t,"1a82c1HibpNnKbRLLbuR9+p","LeaderBoard");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./WebSocket"),a=e("./Minesweeper"),s=cc._decorator,p=s.ccclass,d=s.property,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.refresh=function(){var e=this;i.default.send(JSON.stringify({type:"get.players"}),function(t){var o=e.node.children[5].getComponent(cc.Label),n="";e.game.pid>=0&&e.game.pid<t.length&&t[e.game.pid].Alive?(e.node.children[5].active=!0,n=t[e.game.pid].Name,o.string="Your name: "+t[e.game.pid].Name+"\nYour score: "+t[e.game.pid].Score+"\n"):e.node.children[5].active=!1;for(var r=0;r<t.length;r++)t[r].color=e.game.colors[r],r==e.game.pid&&(t[r].color=cc.color(255,255,255));for(t.sort(function(e,t){return t.Score-e.Score}),r=0;r<5;r++)r<t.length?(e.node.children[r].color=t[r].color,e.node.children[r].children[0].getComponent(cc.Label).string=t[r].Name,e.node.children[r].children[0].color=t[r].color,e.node.children[r].children[1].getComponent(cc.Label).string=t[r].Score,e.node.children[r].children[1].color=t[r].color):(e.node.children[r].children[0].getComponent(cc.Label).string="",e.node.children[r].children[1].getComponent(cc.Label).string="");if(""!=n)for(r=0;r<t.length;r++)n==t[r].Name&&(o.string+="Your rank: "+(r+1).toString()+" of "+t.length.toString())})},c([d(a.default)],t.prototype,"game",void 0),c([p],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./Minesweeper":"Minesweeper","./WebSocket":"WebSocket"}],Lobby:[function(e,t,o){"use strict";cc._RF.push(t,"b12b1npsyhKKKN8kLXvSbk+","Lobby");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./WebSocket"),a=e("./Minesweeper"),s=cc._decorator,p=s.ccclass,d=s.property,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){var e=this;i.default.disconnect=function(){e.disconnect()}},t.prototype.connect=function(){var e=this;i.default.uri="wss://"+this.uri.string,this.state.string="Connecting...",this.connectButton.interactable=!1;try{i.default.connect(function(){i.default.send(JSON.stringify({type:"get.board"}),function(t){e.game.getComponent(a.default).init(t.Width,t.Height),e.game.active=!0,e.ui.active=!0,e.node.active=!1})})}catch(t){this.disconnect()}},t.prototype.disconnect=function(){this.game.active=!1,this.ui.active=!1,this.node.active=!0,this.state.string="Connect server",this.connectButton.interactable=!0},t.prototype.APIdocument=function(){window.location.href="https://github.com/B-10515025/Cocos-Demo/blob/Minesweeper/APIdocument.md"},c([d(cc.Node)],t.prototype,"game",void 0),c([d(cc.Node)],t.prototype,"ui",void 0),c([d(cc.EditBox)],t.prototype,"uri",void 0),c([d(cc.Button)],t.prototype,"connectButton",void 0),c([d(cc.Label)],t.prototype,"state",void 0),c([p],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./Minesweeper":"Minesweeper","./WebSocket":"WebSocket"}],MainMenu:[function(e,t,o){"use strict";cc._RF.push(t,"05936xcTtFFEaOjqsakfGaa","MainMenu");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./WebSocket"),a=e("./Minesweeper"),s=cc._decorator,p=s.ccclass,d=s.property,l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){this.node.on(cc.Node.EventType.MOUSE_DOWN,function(e){e.stopPropagation()}),this.close.on(cc.Node.EventType.MOUSE_DOWN,function(e){e.stopPropagation()}),this.gameover.on(cc.Node.EventType.MOUSE_DOWN,function(e){e.stopPropagation()})},t.prototype.join=function(){var e=this;if(""!=this.nickname.string){var t={type:"action.join",name:this.nickname.string};i.default.send(JSON.stringify(t),function(t){0==t.Code?(e.game.pid=t.Pid,e.closeMenu()):1==t.Code?alert("Name already used"):2==t.Code?alert("Current players is full"):3==t.Code?alert("Game players is full"):4==t.Code?alert("Already in the game"):alert("Unkonwn error")})}},t.prototype.openMenu=function(){this.menu.active=!0,this.close.active=!0,this.button.active=!1},t.prototype.closeMenu=function(){this.menu.active=!1,this.close.active=!1,this.button.active=!0},t.prototype.openLog=function(){var e=this;i.default.send(JSON.stringify({type:"get.history"}),function(t){if(t.length>0){var o=e.log.children[1].getComponent(cc.Label),n=e.log.children[2].getComponent(cc.Label),r=t[t.length-1].Players;o.string="",n.string="",r.sort(function(e,t){return t.Score-e.Score});for(var c=0;c<r.length&&c<20;c++)o.string+=r[c].Name+"\n",n.string+=r[c].Score+"\n"}e.log.active=!0})},t.prototype.closeLog=function(){this.log.active=!1},t.prototype.openPlayers=function(){var e=this;i.default.send(JSON.stringify({type:"get.players"}),function(t){var o=e.players.children[1].getComponent(cc.Label);o.string="";for(var n=0;n<t.length;n++)t[n].Alive&&(o.string+=t[n].Name+"\n");e.players.active=!0})},t.prototype.closePlayers=function(){this.players.active=!1},t.prototype.newGame=function(){var e={type:"system.nextgame",name:this.password.string};i.default.send(JSON.stringify(e),function(e){0!=e.Code&&alert(e.Msg)})},t.prototype.youdied=function(){var e=this;this.gameover.active=!0,this.gameover.opacity=255,cc.tween(this.gameover).then(cc.tween().to(2,{opacity:100})).call(function(){e.gameover.active=!1,e.openMenu()}).start()},c([d(cc.Node)],t.prototype,"button",void 0),c([d(cc.Node)],t.prototype,"close",void 0),c([d(cc.Node)],t.prototype,"menu",void 0),c([d(cc.EditBox)],t.prototype,"nickname",void 0),c([d(cc.EditBox)],t.prototype,"password",void 0),c([d(cc.Node)],t.prototype,"log",void 0),c([d(cc.Node)],t.prototype,"players",void 0),c([d(cc.Node)],t.prototype,"gameover",void 0),c([d(a.default)],t.prototype,"game",void 0),c([p],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./Minesweeper":"Minesweeper","./WebSocket":"WebSocket"}],Minesweeper:[function(e,t,o){"use strict";cc._RF.push(t,"4a375FLT9VPiZMM2V5/9ATp","Minesweeper");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=this&&this.__decorate||function(e,t,o,n){var r,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(c<3?r(i):c>3?r(t,o,i):r(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./WebSocket"),a=e("./Block"),s=e("./LeaderBoard"),p=e("./MainMenu"),d=cc._decorator,l=d.ccclass,u=d.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockSize=40,t.moving=!1,t.preState="",t.pid=-1,t}return r(t,e),t.prototype.onLoad=function(){var e=this;this.node.on(cc.Node.EventType.MOUSE_DOWN,function(t){t.getButton()===cc.Event.EventMouse.BUTTON_LEFT&&(e.moving=!0)}),this.node.on(cc.Node.EventType.MOUSE_MOVE,function(t){e.moving&&(e.board.x+=t.getDelta().x,e.board.y+=t.getDelta().y,e.board.x<e.node.width/2-e.boardWidth/2*e.blockSize&&(e.board.x=e.node.width/2-e.boardWidth/2*e.blockSize),e.board.x>e.boardWidth/2*e.blockSize-e.node.width/2&&(e.board.x=e.boardWidth/2*e.blockSize-e.node.width/2),e.board.y<e.node.height/2-e.boardHeight/2*e.blockSize&&(e.board.y=e.node.height/2-e.boardHeight/2*e.blockSize),e.board.y>e.boardHeight/2*e.blockSize-e.node.height/2&&(e.board.y=e.boardHeight/2*e.blockSize-e.node.height/2))}),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(){e.moving=!1}),this.node.on(cc.Node.EventType.MOUSE_UP,function(t){t.getButton()===cc.Event.EventMouse.BUTTON_LEFT&&(e.moving=!1)}),this.colors=[];for(var t=0;t<64;t++){for(var o=void 0,n=!0,r=1e3;n&&r>0;){r--,o=cc.color(190*Math.random()+50,190*Math.random()+50,190*Math.random()+50),n=!1;for(var c=0;c<this.colors.length;c++)if((this.colors[c].r-o.r)*(this.colors[c].r-o.r)+(this.colors[c].g-o.g)*(this.colors[c].g-o.g)+(this.colors[c].b-o.b)*(this.colors[c].b-o.b)<2e3){n=!0;break}}this.colors.push(o)}},t.prototype.init=function(e,t){this.boardWidth=e,this.boardHeight=t;var o=(this.boardWidth/2-.5)*-this.blockSize,n=(this.boardHeight/2-.5)*-this.blockSize;this.board.destroyAllChildren(),this.blockList=[];for(var r=0;r<this.boardHeight;r++)for(var c=0;c<this.boardWidth;c++){var i=cc.instantiate(this.blockPrefab);i.parent=this.board,i.setPosition(o+i.width*r,n+i.height*c),i.getComponent(a.default).index=this.boardWidth*r+c,i.getComponent(a.default).game=this,this.blockList.push(i.getComponent(a.default))}this.preState="",this.menu.openMenu()},t.prototype.update=function(){var e=this;i.default.callbackList&&0==i.default.callbackList.length&&i.default.send(JSON.stringify({type:"get.board"}),function(t){var o=JSON.stringify(t);t.Playing?e.gamestate.string="Game Index: "+t.GID.toString():e.gamestate.string="Game Loading...",e.preState!=o&&(e.leaderboard.refresh(),e.preState=o);for(var n=0;n<e.blockList.length;n++)n<t.Client.length&&e.blockList[n].setState(t.Client[n])})},c([u(cc.Prefab)],t.prototype,"blockPrefab",void 0),c([u(cc.Node)],t.prototype,"board",void 0),c([u(s.default)],t.prototype,"leaderboard",void 0),c([u(p.default)],t.prototype,"menu",void 0),c([u(cc.Label)],t.prototype,"gamestate",void 0),c([l],t)}(cc.Component);o.default=f,cc._RF.pop()},{"./Block":"Block","./LeaderBoard":"LeaderBoard","./MainMenu":"MainMenu","./WebSocket":"WebSocket"}],WebSocket:[function(e,t,o){"use strict";cc._RF.push(t,"cdaefTafxBBhZ3tctK3kB4i","WebSocket"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.connect=function(t){e.ws=new WebSocket(e.uri),e.ws.onopen=function(){console.log("connected to "+e.uri),e.isOpen=!0,e.callbackList=[],t()},e.ws.onclose=function(t){console.log("connection closed ("+t.code+")"),e.isOpen=!1,e.disconnect(t)},e.ws.onmessage=function(t){e.callbackList[0](JSON.parse(t.data)),e.callbackList.shift()}},e.send=function(t,o){e.isOpen&&(e.ws.send(t),e.callbackList.push(o))},e.isOpen=!1,e}();o.default=n,cc._RF.pop()},{}]},{},["Block","LeaderBoard","Lobby","MainMenu","Minesweeper","WebSocket"]);